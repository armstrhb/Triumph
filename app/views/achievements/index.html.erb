<div class="container">
  <div class="header">
    <h1><%= @realm.name %> <small>Achievements</small></h1>
  </div>
  <div class="row">
    <div class="col-sm-4">
      <%= pluralize(@achievements.length, "achievement") %>
    </div>
    <div class="col-sm-4">
      <%= pluralize(@categories.length, "category") %>
    </div>
    <div class="col-sm-4">
      <%= link_to pluralize(@rarities.length, "rarity"), rarities_path(@realm) %>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12">
      <button id="new-achievement-button" class="btn btn-default" data-toggle="modal" data-target="#new-achievement-modal">New Achievement</button>
    </div>
  </div>
  <div class="row">
      <table id="achievement-table" class='table table-striped table-hover' <%= "style=display:none;" if @achievements.length == 0 %>>
        <tr>
          <th>Achievement/Description</th>
          <th>Rarity</th>
          <th>Category</th>
        </tr>
        <%= render @achievements %>
      </table>
      <% if @achievements.length == 0 %>
      <div class="col-sm-12">
        <span class="text-muted">There are no achievements in this realm.</span>
      </div>
    <% end %>
  </div>
</div>

<div id="new-achievement-modal" class="modal fade" tabindex="-1" aria-labelledby="myModalLabel" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Create Achievement</h4>
      </div>
      <div class="modal-body">
      <%= form_for(@new_achievement, :html => { :id => "new_achievement_form", :class => "form"}, remote: true) do |f| %>
        <div class='form-group'>
          <%= f.label :title %>
          <%= f.text_field :title, :class => 'form-control' %>
        </div>
        <div class='form-group'>
          <%= f.label :description %>
          <%= f.text_field :description, :class => 'form-control' %>
          <span class="help-block">A short descriptor of the achievement.</span>
        </div>
        <div class='form-group'>
          <%= f.label :active_start %>
          <%= f.date_field :active_start, :class => 'form_control' %>
        </div>
        <div class='form-group'>
          <%= f.label :active_end %>
          <%= f.date_field :active_end, :class => 'form_control' %>
        </div>
        <div class='form-group checkbox-inline'>
          <%= f.check_box :repeatable, :class => 'form_control' %>
          <%= f.label :repeatable %>
        </div>
        <%= f.hidden_field :realm_id, :value => @realm.id %>
        <div class='form-group'>
          <%= f.label :category %>
          <%= f.collection_select(:category_id, @categories.all, :id, :name, {}, {:class => 'form-control'}) %>
        </div>
        <div class='form-group'>
          <%= f.label :rarity %>
          <%= f.collection_select(:rarity_id, @rarities.all, :id, :name, {}, {:class => 'form-control'}) %>
        </div>
        <div class='form-group'>
          <%= f.label :required_ticks %>
          <%= f.number_field(:required_ticks, in: 1..100000000, :class => 'form-control') %>
          <span class="help-block">Needs to be positive :)</span>
        </div>
        <div class='form-group'>
          <%= f.label :points %>
          <%= f.number_field(:points, in: 1..1000, :class => 'form-control') %>
          <span class="help-block">Needs to be positive, too.</span>
        </div>
        </div>
        <div class="modal-footer">
          <%= f.submit :class => 'btn btn-primary' %>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      <% end %>
    </div>
    </div>
  </div>
</div>

<script>
  $.fn.modal_success = function(){
      this.modal('hide');
      showSuccess();
  };

  $("tr[data-link]").click(function() {
    window.location = this.dataset.link;
  });

  //$(document).on('click', '.achievement-item', {}, function(e) {
  //  window.location = $(e.currentTarget).dataset.link;
  //});

  $("#new_achievement_form").on("ajax:error", function(event, xhr, status, error) {
    //handleErrors($.parseJSON(xhr.responseText));
  }).on("ajax:complete", function(xhr, status) {
    $('#new-achievement-modal').modal('hide');
  }).on("ajax:beforeSend", function(event, xhr, settings) {
    //$("#error-message").hide();
  });
</script>
